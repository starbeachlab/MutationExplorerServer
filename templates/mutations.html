{% import "bootstrap/wtf.html" as wtf %}


<h1> MutationViewer</h1>


<div id="main" style="width:100%">
  <div id="formdiv" style="float:left;width:30%;">

    <form method="POST" enctype="multipart/form-data"  >
      {{ form.csrf_token }}

      <h2> Upload section </h2>
      
      <h3> {{ form.pdb.label }} </h3>
      {{ form.pdb }}

      <p> <b>OR</b> upload PDB file from one of the following servers: </p>

      <h3> {{ form.idstr.label }} </h3>
      {{form.idstr}}
      
      <h3> {{ form.source.label }} </h3>
      {{form.source}}
      
      <p> <b> OR: </b> </p>

      <h3> {{form.opensession.label}} </h3>
      {{ form.opensession }}
      
      <h2> Mutation section </h2>

      
      <h3> {{form.ali.label}} </h3>
      {{form.ali}}

      <p><b> OR:</b></p>
      
      <h3> {{form.mutations.label}} </h3>
      {{form.mutations}}

      <h2> Display section </h2>
      
      <h3> {{form.display.label}} </h3>
      {{form.display}}

      <h2> Download section </h2>
      
      <h3> {{form.download.label}}</h3>
      {{form.download}}
      <br>
      <br>

      
      <h2> Update <h2>
	  {{form.submit}}
	  
    </form>
    <br>
    
    <div id="session_id">Current session ID: {{mydir}}</div>

    <div id="history">History: {{history}} </div>
    
  </div>
  <div id="ngldiv" style="float:right:width:70%; height:100%;">

    <div id="viewport" style="width: 70%; height: 100vh;"></div>

  </div>
</div>

<script src="{{url_for('static', filename='ngl.js')}}"></script>


<script> 
    NGL.mainscriptPathFile = "{{url_for('static', filename='ngl.js')}}";

    document.addEventListener( "DOMContentLoaded",  function() {

        stage = new NGL.Stage("viewport");
        stage.setParameters( { backgroundColor: "green" } );
        var loc = window.location;
        var file = loc.protocol + "//" + loc.host + "{{url_for('get', mydir=mydir, pdb=pdb)}}";
        console.log( file );
        
        // load molecule structure
        stage.loadFile( file, {defaultRepresentation: true} ).then( function( comp){
            // console.log( "loaded file: " + file);
            comp.setName( "structure");
            //comp.setSelection( "");
            //comp.addRepresentation( "cartoon", {color: "bfactor" , colorReverse: true} );
            comp.autoView();
        });
    
    });
    
</script>

