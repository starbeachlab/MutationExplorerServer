{% import "bootstrap/wtf.html" as wtf %}


<h1> MutantX</h1>


<div id="main" style="width:100%">
  <div id="formdiv" style="float:left;width:30%;">

    <form method="POST" enctype="multipart/form-data"  >
      {{ form.csrf_token }}

      <h3> Start new session</h3>
      
      <h4> {{ form.pdb.label }} </h4>
      {{ form.pdb }}


      <h4> {{ form.idstr.label }} </h4>
      {{form.idstr}}
      <h4> {{ form.source.label }} </h4>
      {{form.source}}
      

      <h4> {{form.opensession.label}} </h4>
      {{ form.opensession }}
      

      <br>
      <br>
 
      <h3 title="Example: 'A:S12T' replaces Ser at residue ID 12 in chain A with Thr. The residue ID is used as given in the PDB file. If there is no chain information in your PDB file use '_:S12T'."> {{form.mutations.label}} <img src="static/img/info.png"> </h3>
      {{form.mutations}}
      
      <h4> {{form.display.label}} </h4>
      {{form.display}}

      <h4> {{form.download.label}}</h4>
      {{form.download}}

      <br><br>

      <h3 title="Generally, updating the website should not require more than 1 minute. However, if you apply many mutations in many chains this may take longer."> Send your request to server <img src="static/img/info.png"> </h3>
      {{form.submit}}
	  
    </form>
    <br>
    <div id="msg" style="color:green;"><b>{{msg}}</b></div>
    <br>
    <div id="range"> Energy range: {{mini}} ... {{maxi}}  </div>
    <p> Note that positive values are chopped above the absolute of the minimum!</p>
    <br>
    
    <div id="session_id">Current session ID: {{mydir}}</div>

    <div id="history">History: {{history}} </div>
    
  </div>
  <div id="ngldiv" style="float:right:width:70%; height:100%;">

    <div id="viewport" style="width: 70%; height: 100vh;"></div>

  </div>
</div>

<script src="{{url_for('static', filename='ngl.js')}}"></script>


<script> 
    NGL.mainscriptPathFile = "{{url_for('static', filename='ngl.js')}}";

    document.addEventListener( "DOMContentLoaded",  function() {

        stage = new NGL.Stage("viewport");
        stage.setParameters( { backgroundColor: "grey" } );
        var loc = window.location;
        var file = loc.protocol + "//" + loc.host + "{{url_for('get', mydir=mydir, pdb=pdb)}}";
        console.log( file );
        
        // load molecule structure
        stage.loadFile( file, {defaultRepresentation: false} ).then( function( comp){
            // console.log( "loaded file: " + file);
            comp.setName( "structure");
            //comp.setSelection( "");
            comp.addRepresentation( "cartoon", {color: "bfactor" , colorReverse: true} );
            {{repos}}
            comp.autoView();
        });
    
    });
    
</script>

