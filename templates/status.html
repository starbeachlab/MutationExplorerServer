{% extends "base.html" %}

{% block content %}

<center>
<h1>Status {{tag}}</h1>
</center>

<p id="wait-text">
    The submitted structure is currently being mutated and new energy values are being calculated.
    This may take a few minutes, depending on the size of the protein.
    <br>
    You will be automatically redirected when the calculation is done.
    <br>
    <br>
    You can access the results from this link: <br>
  <a href="/explore/{{tag}}/{{filename}}">Result Page</a>
</p>
<p id="status-msg"></p>
<p id="error-msg"></p>


{% endblock %}


{% block scripts %}

<script>

    $().ready(function() {
        update_progress()
    })

    function statusMessage(m) {
        $("#status-msg").html(m);  
    }


    function errorMessage(m) {
        $("#wait-text").css("display", "none");
        $("#error-msg").text(m);
        console.log(m)
    }


    function update_progress() {
        console.log("check:  {{tag}} {{filename}} " );
        $.getJSON("{{url_for('get_status', tag = tag, filename = filename)}}", function(data) {
            if(data['done'] != true) {
                statusMessage("Status: <br>" + data['message'])
            }
            if(data['done'] == true) {
                if(data['status'] == 'done') {
                    window.location.href = "{{url_for('explore', tag = tag, filename = filename)}}"
                } else {
                    errorMessage("There was an error: \"" + data['message'] + "\"")
                }
            } else {
                setTimeout(function() {
                    update_progress()
                }, 5000)
            }
        })
    }

</script>

{% endblock %}
